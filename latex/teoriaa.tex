


\chapter{Teoriaa}\label{teor}

\section{Perusmääritelmiä}

Määritellään ensiksi todennäköisyys.

\begin{maar}
	\textit{$\sigma$-algebra.} Olkoot $\Omega$ mielivaltainen epätyhjä joukko. Sigma-algebra perusjoukolla $\Omega$ on sen osajoukkojen joukkoperhe $\mathcal{F}$, joka toteuttaa ehdot:
	
	\begin{enumerate}
		\item $\emptyset\in\mathcal{F}$
		\item jos $A\in\mathcal{F},\ niin\ A^c \in\mathcal{F}$
		\item jos jos $A_k\in\mathcal{F},\ kaikilla\ k\in K$, missä $K$ on numeroituva joukko, niin $\bigcup_{k\in K} A_k \in \mathcal{F}$
	\end{enumerate}
\end{maar}

\begin{maar}
	Kuvaus \pr\ liittää kuhunkin tapahtumaan $A$ \textit{todennäköisyyden}, joka on luku suljetulla välillä [0,1] ja sille pätee:
	\begin{enumerate}
		\item $\pr(\Omega)=1$
		\item Jos $A$ on tapahtuma, niin sen komplementtitapahtuman $A^c$ todennäköisyys on $\pr(A^c)= 1 - \pr(A)$
		\item Jos $(A_k)_{k\in\N}$ ovat erillisiä tapahtumia, niin 
		\begin{displaymath}
			\pr(\bigcup_{k\in\N} A_k) = \sum_{k\in\N}\pr(A_k)
		\end{displaymath}
	\end{enumerate}
\end{maar}

\begin{maar}
	Kolmikkoa $(\Omega, \mathcal{F}, \pr )$ kutsutaan \textit{todennäköisyysavaruudeksi}.
\end{maar}

\begin{maar}
	\textit{Satunnaismuuttuja} $X$ on (lähes) mielivaltainen kuvaus $X:\Omega\rightarrow S$, jossa $S$ on \textit{tilajoukko}. 
\end{maar}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  Tässä Markovin ketjuista   %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Markovin ketjut}

Esitellään ensiksi joitain perus asioita Markovin Ketjuista, sillä ne eivät kuulu sellaisenaan opetussuunnitelmaan. \cite{piiroinen_stokastiset_nodate}

\subsection{Äärellinen tilajoukko}

\begin{maar}
	Jono $(X_n:n=1,2,3,...)$ satunnaismuuttujia on diskreettiaikainen \textit{stokastinen prosessi}.
\end{maar}

\begin{merk}
	Merkitään stokastista prosessia merkinnällä $\{ X_n \}$
\end{merk}

\begin{maar}
	Stokastinen prosessi $\{X_n\}$ on \textit{Markovin ketju}, jos kaikilla alkuhetkillä $m,n$ ja tiloilla $i,j\in S$ on voimassa
	\begin{equation}\label{markov-property}
		\begin{split}
			&\pr(X_{n+1}=j|X_0=i_0,X_1=i_1,...,X_{n-1}=i_{n-1},X_n=i) \\
		 &= \pr(X_{n+1}=j|X_n=i) 
		\end{split}
	\end{equation}
	ja \textit{siirtymätodennäköisyyksille} on voimassa 
	\begin{equation}\label{stationary}
		p_{ij}=\pr(X_{n+1}=j|X_n=i)=\pr(X_{m+1}=j|X_m=i)
	\end{equation}
	Yhtälöä \ref{markov-property} kutsutaan \textit{Markovin-ehdoksi} ja yhtälöä \ref{stationary} taas kutsutaan \textit{stationarisuusehdoksi}, mikä tarkoittaa, 
	että siirtymätodennäköisyys tilojen $i\ \text{ja}\ j$ välillä ei riipu ajasta $m\ \text{ja}\ n$, vaan pelkästään tiloista $i\ \text{ja}\ j$.
\end{maar}

\begin{maar}
	Satunnaismuuttujan $X_0$ jakaumaa kutsutaan \textit{alkujakaumaksi}. 
\end{maar}

\begin{lause}
	Ajanhetkellä $n\geq 1$ polun $(i_0,...i_n)$ todennäköisyys on 
	\begin{equation}
		\pr (X_0=i_0,...,X_n=i_n) = p_{i_0} p_{i_0,i_1} p_{i_1,i_2} ... p_{i_{n-1},i_n}
	\end{equation} 
\end{lause}
\begin{proof}
	Käyttäen ehdollisen todennäköisyyden kaavaa, saadaan 2:lle tapahtumalle
	\begin{equation*}
		\pr (A_0, A_1)=\pr(A_0)\pr(A_1|A_0)
	\end{equation*}
	Jos tapahtumia on kolme, saadaan
	\begin{equation*}
		\pr (A_0, A_1, A_2)=\pr(A_0)\pr(A_1|A_0)\pr(A_2|A_1, A_0)
	\end{equation*}
	neljä
	\begin{equation*}
		\pr (A_0, A_1, A_2, A_3)=\pr(A_0)\pr(A_1|A_0)\pr(A_2|A_1, A_0)\pr(A_3|A_2,A_1,A_0)
	\end{equation*}
	ja n
	\begin{equation}\label{condprob}
		\pr (A_0,...,A_n)=\pr(A_0)\pr(A_1|A_0)...\pr(A_n|A_{n-1},...A_0)
	\end{equation}
	Tämä on yleinen ehdollinen todennäköisyys. Merkataan $A_n \coloneqq (X_i=i_n)$. Koska käsittelemme Markovin ketjua, niin yhtälö \ref{markov-property} pätee, jolloin yhtälöstä \ref{condprob} saadaan 
	\begin{equation*}
		\pr(X_0=i_0,...,X_n=i_n) = \pr(X_0=i_0) \pr(X_1=i_1|X_0=i_0)...\pr(X_n=i_n|X_{n-1}=i_{n-1})
	\end{equation*}
	jossa $\forall n=0,1,2,...,n: \pr(X_n=i_n|X_{n-1}=i_{n-1})$ on siirtymätödennäköisyys $p_{i_{n-1},i_n}$ jolloin tulos seuraa substituoimalla termit.
\end{proof}

\begin{merk}
	\begin{equation}
		p_{ij}^{(m)} \coloneqq \pr (X_m=j|X_0=i),\ i,j\in S,m\in T
	\end{equation}
	on siirtymätodennäköisyys tilasta $i$ tilaan $j$, kun aikaa kuluu $m$ yksikköä.
\end{merk}

\begin{maar}
	\textit{Siirtymämatriisi} on matriisi
	\begin{equation}
		\pr ^{(m)} \coloneqq (p_{ij}^{(m)})_{i,j} =
		\begin{pmatrix}
			p_{00}^{(m)} & p_{01}^{(m)} & \dots & p_{0n}^{(m)} \\
			p_{10}^{(m)} & p_{11}^{(m)} & \dots & p_{1n}^{(m)} \\
			\vdots & & \ddots & \vdots \\
			p_{n0}^{(m)} & p_{n1}^{(m)} & \dots & p_{nn}^{(m)}
		\end{pmatrix}
	\end{equation}
\end{maar}

\begin{lause}
	Kaikilla ajanhetkillä on voimassa
	\begin{equation}
		\pr ^{(m)} = \pr ^m
	\end{equation}
\end{lause}
\begin{proof}
	Todistus on melko pitkä, joten ohitetaan se.
\end{proof}

\begin{maar}
	Todennäköisyysjakauma $\pi=(\pi)_{i\in S}$ on Markovin ketjun $\{X_n\}$ tasapainojakauma, jos 
	\begin{equation}\label{stationary-dist}
		\sum_{i\in S} \pi_i p_{ij}=\pi_j, \forall j\in S
	\end{equation}
	Yhtälö \ref{stationary-dist} voidaan kirjoittaa myös muotoon 
	\begin{equation}\label{stationary-dist2}
		\pi^T\pr= \pi^T
	\end{equation}
\end{maar}

\begin{lause}
	Äärellisellä Markovin ketjulla on aina jokin tasapainojakauma $\pi$.
\end{lause}

\begin{maar}\label{kaant-disk}
	Markovin ketju on \textit{kääntyvä}, jos löytyy sellainen TN-jakauma $\lambda=(\lambda_i)_{i\in S}$, että 
	\begin{equation}
		\lambda_ip_{ij}= \lambda_jp_{ji},\forall i,j\in S
	\end{equation}
\end{maar}

\begin{lause}
	Jos Markovin ketju on kääntyvä, niin $\lambda=\pi$ on sen tasapainojakauma.
\end{lause}
\begin{proof}
	\begin{equation*}
		\sum_{i\in S} \lambda_i p_{ij} = \sum_{i\in S} \lambda_j p_{ji} = \lambda_j \sum_{i\in S} p_{ij} = \lambda_j
	\end{equation*}
\end{proof}
\begin{esim}
	Pohditaan lyhyttä esimerkkiä, jossa tilajoukko on $S=\{"sataa", "paistaa"\}$. Määritellään siirtymätodennäköisyydet siirtymämatriisilla
	\begin{displaymath}
		\pr ^{(1)}=  
		\begin{pmatrix}
			0.7 & 0.3 \\
			0.2 & 0.8
		\end{pmatrix}
	\end{displaymath}
	Tämä voidaan visualisoida kuvan \ref{mc-esimerkki1} mukaisesti.
	\begin{figure}[h!]
	\label{mc-esimerkki1}
	\begin{center}
		\begin{tikzpicture}[->,>=stealth',shorten >=1pt,auto,node distance=3cm,semithick]

		\node[state](s){Paistaa};
    	\node[state, right of=s](r){Sataa};
		\draw[every loop]
            (s) edge[bend left] node {0.2} (r)
            (r) edge[bend left] node {0.3} (s)
            (r) edge[loop right] node {0.7} (r)
            (s) edge[loop left] node {0.8} (s);
	\end{tikzpicture}
	\caption[Yksinkertainen esimerrki Markovin ketjusta]{Esimerkki \ref{mc-esimerkki1}}
	\end{center}
	\end{figure}
	Ketju on äärellinen, joten sillä on tasapainojakauma. Yhtälö \ref{stationary-dist2} implikoi, että jakauma $\pi$ on siirtymämatriisin $\pr$ vasen ominaisvektori ($\pi^T\pr=\lambda\pi^T$, jossa $\lambda=1$). Tämä voidaan ratkaista numeerisesti, ja ratkaisu on $\pi^T=(0.4, 0.6)$. Helposti nyt nähdään, että \ref{stationary-dist2} pätee.
\end{esim}

\subsection{Ääretön jatkuva tilajoukko}
Kun Markovin ketjun tilajoukko $S$ ei olekkaan rajattu (esimerkiksi, jos halutaan simuloida normaalijakaumasta, joka voi saada minkä vain arvon väliltä $(-\infty,\infty)$), niin teoria muuttuu hieman. Suurin osa tuloksista pätee pienin muutoksin, mutta niiden todistaminen on hankalaa ja ylittää kanditason. Esitetään kuitenkin tarvittavat perustulokset.


\begin{maar}
	Kun $S$ on rajoittamaton, siirtymämatriisi on parasta ajatella kuvauksena $T: S\times S \rightarrow [0,1]$, joka kuvaa tilaparin $x,y\in S$ todennäköisyydeksi $T(x,y)$
\end{maar}

\begin{maar}
	Iistymätodennäköisyys $p^{(n)}_{ij}$ voidaan kirjoittaa \textit{siirtymätiheytenä} $T^{(n)}(x,y)$, jolle pätee
	\begin{equation}\label{siirt-tiheys}
		\int_S T(x,y)dy = 1 \hspace{1cm} \text{ja} \hspace{1cm} \int_S T^{(n)}(x,y)dy = 1, \forall n \geq 1
	\end{equation}
\end{maar}

\begin{maar}
	Jakauma $\pi$ on Markovin ketjun $\{ X_n \}$ kun $S$ on jatkuva, tasapainojakauma jos 
	\begin{equation}
		\pi(y) = \int_S \pi(x) T(x,y) dx
	\end{equation}
\end{maar}

\begin{maar}\label{kaant-jatk}
	Markovin ketju jatkuvassa $S$:ssä on kääntyvä, jos on olemassa 
	\begin{equation}
		\pi(x)T(x,y)=\pi(y)T(y,x), \forall x,y\in S
	\end{equation}
\end{maar}

\begin{lause}
	Jos Markovin ketju $\{X_n\}$ on kääntyvä ja tilajoukko $S$ on jatkuva, niin $\pi$ on sen tasapainojakauma.
\end{lause}

\begin{proof}
	Yhtälön \ref{siirt-tiheys} mukaan $\int_S T(y,x)dx = 1$, joten
	\begin{equation}
		\int_S \pi(x) T(x,y) dx = \int_S \pi(y) T(y,x) dx = \pi(y)\int_S T(y,x) dx = \pi(y)
	\end{equation}
\end{proof}

\begin{maar}
	Markovin ketjuissa voimme myös tietyin ehdoin yhdistää siirtymätiheyksiä. Tällöin puhutaan syklisistä siirtymätiheyksistä. Voidaan esimerksiksi määritellä
	\begin{equation*}
		T_1...T_d
	\end{equation*}
	siirtymätiheys.
\end{maar}

\begin{lause}\label{cyclic-kernel}
	Jos $\pi$ on tasapainojakauma kaikille siirtymätiheyksille $T_1,...,T_d$, niin se on tasapainojakauma siirtymätiheydelle $T = T_1...T_d$.
\end{lause}

\begin{proof}
	\begin{equation*}
		\pi T = \pi T_1...T_d = \pi T_2...T_d = ... = \pi T_d = \pi
	\end{equation*}
\end{proof}
























































